jQuery(function(e){if("undefined"==typeof orr_reservation_params)return!1;var a={$reservation_form:e("form.reservation"),init:function(){this.init_datepicker(),this.$reservation_form.on("input validate change",".input-text, select, input:checkbox",this.validate_field),e(document.body).on("click",".reservation-notes-toggle",this.onToggleNotes)},init_datepicker:function(){e(".date-picker-field, .date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,minDate:0,maxDate:"+1m +1w",gotoCurrent:!0,beforeShowDay:this.disable_days,onSelect:function(e){a.on_change_date(e)}})},on_change_date:function(a){var t={security:orr_reservation_params.date_changed_nonce,date:a,action:"online_restaurant_reservation_on_date_select"},r=e('<button class="orr-loader"/>').text("Loading....").css({width:"100%",background:"#f9f9f9",color:"#000","text-align":"left"});e.ajax({url:orr_reservation_params.ajax_url,data:t,type:"POST",beforeSend:function(){e("#reservation_time").hide(),e("#reservation_time_field").append(r)},success:function(a){if("boolean"==typeof a.success&&!0===a.success){var t=a.data.time_slot,r=e("#reservation_time").clone().removeAttr("style");r.html("");for(var i in t)r.append('<option value="'+i+'">'+t[i]+"</option>");r.find("option").length<1&&r.append('<option value="-1">Time slot not available</option>'),e("#reservation_time").remove(),e("#reservation_time_field").find(".orr-loader").remove(),e("#reservation_time_field").append(r)}}})},disable_days:function(t){var r=t.getDay();return a.is_date_closed_by_exception(t)?[!1,"ui-datepicker-closed exceptional-days","Closed exceptional"]:a.is_date_opened_by_exception(t)?[!0,"ui-datepicker-opened","Opened exceptional"]:-1!==e.inArray(r,orr_reservation_params.closed_days)?[!1,"ui-datepicker-closed","Closed"]:[!0,"ui-datepicker-opened","Open"]},is_date_closed_by_exception:function(e){for(var t=e.getMonth(),r=e.getDate(),i=e.getFullYear()+"-"+(t+1)+"-"+r,n=orr_reservation_params.exceptional_closed_days,o=!1,d=0;d<n.length;d++){var F=n[d].start_date,u=n[d].end_date;if(o=a.is_date_between(i,F,u))break}return o},is_date_opened_by_exception:function(e){for(var t=e.getMonth(),r=e.getDate(),i=e.getFullYear()+"-"+(t+1)+"-"+r,n=orr_reservation_params.exceptional_opened_days,o=!1,d=0;d<n.length;d++){var F=n[d].start_date,u=n[d].end_date;if(o=a.is_date_between(i,F,u))break}return o},is_date_between:function(e,a,t){var r=a.split("-"),i=t.split("-"),n=e.split("-"),o=new Date(r[0],parseInt(r[1],10)-1,r[2]),d=new Date(i[0],parseInt(i[1],10)-1,i[2]),F=new Date(n[0],parseInt(n[1],10)-1,n[2]);return F>=o&&F<=d},validate_field:function(a){var t=e(this),r=t.closest(".form-row"),i=!0,n=r.is(".validate-required"),o=r.is(".validate-email"),d=a.type;"input"===d&&r.removeClass("orr-invalid orr-invalid-required-field orr-invalid-email orr-validated"),"validate"!==d&&"change"!==d||(n&&("checkbox"!==t.attr("type")||t.is(":checked")?""===t.val()&&(r.removeClass("orr-validated").addClass("orr-invalid orr-invalid-required-field"),i=!1):(r.removeClass("orr-validated").addClass("orr-invalid orr-invalid-required-field"),i=!1)),o&&t.val()&&(new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i).test(t.val())||(r.removeClass("orr-validated").addClass("orr-invalid orr-invalid-email"),i=!1)),i&&r.removeClass("orr-invalid orr-invalid-required-field orr-invalid-email").addClass("orr-validated"))},onToggleNotes:function(a){a.preventDefault();var t=e(this).closest("div");t.find(".reservation-notes").show(),t.find(".reservation-notes-toggle").hide()}};a.init()});